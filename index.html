<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SETEC POS</title>
  <!-- Fonts -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/source-sans-3@5.0.12/index.css" integrity="sha256-tXJfXfp6Ewt1ilPzLDtQnJV4hclT9XuaZUKyUvmyr+Q=" crossorigin="anonymous" />
  <!-- Third Party Plugins -->
   <!-- OverlayScrollbars CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.10.1/styles/overlaysscrollbars.min.css" integrity="sha256-tZHrRjVqNSRyWg2wbppGnT833E/Ys0DHWGwT04GiqQg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" integrity="sha256-9kPW/n5nn53j4WMRYAxe9c1rCY96Oogo/MKSVdKzPmI=" crossorigin="anonymous" />
  <!-- Admin CSS -->
  <link rel="stylesheet" href="admin.css" />
</head>
<body class="layout-fixed sidebar-expand-lg bg-body-tertiary">
  <div class="app-wrapper">
    <aside class="app-sidebar bg-body-secondary shadow" data-bs-theme="dark">
      <div class="sidebar-brand">
        <a href="index.html" class="brand-link">
          <img src="../img/setec logo.png" alt="AdminLTE Logo" class="brand-image opacity-75 shadow" />
          <span class="brand-text fw-light">SETEC POS</span>
        </a>
      </div>
      <div class="sidebar-wrapper">
        <nav class="mt-2">
          <ul class="nav sidebar-menu flex-column" data-lte-toggle="treeview" role="menu" data-accordion="false">
            <li class="nav-item">
              <a href="#" class="nav-link" onclick="showSection('dashboard')">
                <i class="nav-icon fa-solid fa-gauge-high"></i>
                <p>Dashboard</p>
              </a>
            </li>
            <!-- PRODUCTS MENU -->
            <li class="nav-item">
              <a href="#" class="nav-link">
                <i class="nav-icon fa-solid fa-box-open"></i>
                <p>
                  Products
                  <i class="nav-arrow bi bi-chevron-right"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="#" class="nav-link" onclick="showSection('addProduct')">
                    <i class="nav-icon bi bi-circle"></i>
                    <p>Add Product</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="#" class="nav-link" onclick="showSection('listProduct')">
                    <i class="nav-icon bi bi-circle"></i>
                    <p>List Products</p>
                  </a>
                </li>
              </ul>
            </li>
            <!-- CATEGORIES MENU -->
            <li class="nav-item">
              <a href="#" class="nav-link">
                <i class="nav-icon fa-solid fa-layer-group"></i>
                <p>
                  Categories
                  <i class="nav-arrow bi bi-chevron-right"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="#" class="nav-link" onclick="showSection('addCategory')">
                    <i class="nav-icon bi bi-circle"></i>
                    <p>Add Category</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="#" class="nav-link" onclick="showSection('listCategory')">
                    <i class="nav-icon bi bi-circle"></i>
                    <p>List Categories</p>
                  </a>
                </li>
              </ul>
            </li>
            <!-- ORDERS MENU -->
            <li class="nav-item">
              <a href="#" class="nav-link">
                <i class="nav-icon bi bi-cart4"></i>
                <p>
                  Orders
                  <i class="nav-arrow bi bi-chevron-right"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="#" class="nav-link" onclick="showSection('addOrder')">
                    <i class="nav-icon bi bi-circle"></i>
                    <p>Add Order</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="#" class="nav-link" onclick="showSection('listOrders')">
                    <i class="nav-icon bi bi-circle"></i>
                    <p>List Orders</p>
                  </a>
                </li>
              </ul>
            </li>
            <!-- USERS MENU -->
            <li class="nav-item">
              <a href="#" class="nav-link">
                <i class="nav-icon bi bi-people-fill"></i>
                <p>
                  Users
                  <i class="nav-arrow bi bi-chevron-right"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="#" class="nav-link" onclick="showSection('addUser')">
                    <i class="nav-icon bi bi-circle"></i>
                    <p>Add Users</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="#" class="nav-link" onclick="showSection('listUsers')">
                    <i class="nav-icon bi bi-circle"></i>
                    <p>List Users</p>
                  </a>
                </li>
              </ul>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link" onclick="showSection('sitting')">
                <i class="nav-icon bi bi-gear-fill"></i>
                <p>Sitting</p>
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </aside>

    <main class="app-main">
      <div class="app-content-header">
        <div class="container-fluid">
          <div class="row">
            <div class="col-sm-6">
              <h3 class="mb-0">Dashboard</h3>
            </div>
            <div class="col-sm-6">
              <ol class="breadcrumb float-sm-end">
                <li class="breadcrumb-item"><a href="#">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">Dashboard</li>
              </ol>
            </div>
          </div>
        </div>
      </div>

      <!-- DASHBOARD SECTION -->
      <div class="app-content" id="dashboard" style="display:block;">
        <div class="container-fluid">
          <div class="row">
            <div class="col-lg-3 col-6">
              <div class="small-box text-bg-primary">
                <div class="inner ">
                  <h3 id="productCount" >0</h3>
                  <p>Products</p>
                </div>
              </div>
            </div>
            <div class="col-lg-3 col-6">
              <div class="small-box text-bg-success">
                <div class="inner">
                  <h3 id="orderCount">0</h3>
                  <p>Orders</p>
                </div>
              </div>
            </div>
            <div class="col-lg-3 col-6">
              <div class="small-box text-bg-warning">
                <div class="inner">
                  <h3 id="categoryCount">0</h3>
                  <p>Categories</p>
                </div>
              </div>
            </div>
            <div class="col-lg-3 col-6">
              <div class="small-box text-bg-danger">
                <div class="inner">
                  <h3 id="userCount">0</h3>
                  <p>Users</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- END DASHBOARD SECTION -->

      <!-- ADD PRODUCT SECTION -->
      <div class="app-content" id="addProduct" style="display:none;">
        <div class="container-fluid">
          <h2>Add Product</h2>
          <input type="hidden" id="editProductIndex" value="-1" />
          <form onsubmit="handleProductForm(event)">
            <input type="text" id="productName" class="form-control mb-2" placeholder="Product Name" required>
            <input type="number" id="productPrice" class="form-control mb-2" placeholder="Price" required>
            <input type="number" id="productQty" class="form-control mb-2" placeholder="Quantity" required>
            <select id="category" class="form-control mb-2" required>
              <option value="">Select Category</option>
            </select>
            <textarea id="productDesc" class="form-control mb-2" placeholder="Description"></textarea>
            <button type="submit" class="btn btn-primary" id="productBtn">Save Product</button>
          </form>

          <h3 class="mt-4">List Products</h3>
          <table class="table table-bordered table-striped" id="productTable">
            <thead>
              <tr>
                <th>#</th>
                <th>Product Name</th>
                <th>Price</th>
                <th>Qty</th>
                <th>Category</th>
                <th>Description</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      </div>
      <!-- END ADD PRODUCT SECTION -->

      <!-- LIST PRODUCT SECTION -->
      <div class="app-content" id="listProduct" style="display:none;">
        <div class="container-fluid">
          <h2>Product List</h2>
          <table class="table table-bordered table-striped" id="productTable2">
            <thead>
              <tr>
                <th>#</th>
                <th>Product Name</th>
                <th>Price</th>
                <th>Qty</th>
                <th>Category</th>
                <th>Description</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      </div>
      <!-- END LIST PRODUCT SECTION -->

      <!-- ADD CATEGORY SECTION -->
      <div class="app-content" id="addCategory" style="display:none;">
        <div class="container-fluid">
          <h2>Add Category</h2>
          <input type="hidden" id="editCategoryIndex" value="-1" />
          <form onsubmit="handleCategoryForm(event)">
            <input type="text" id="categoryName" class="form-control mb-2" placeholder="Category Name" required>
            <button type="submit" class="btn btn-primary" id="categoryBtn">Save Category</button>
          </form>

          <h3 class="mt-4">List Categories</h3>
          <table class="table table-bordered table-striped" id="categoryTable">
            <thead>
              <tr>
                <th>#</th>
                <th>Category Name</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      </div>
      <!-- END ADD CATEGORY SECTION -->

      <!-- LIST CATEGORY SECTION -->
      <div class="app-content" id="listCategory" style="display:none;">
        <div class="container-fluid">
          <h2>Category List</h2>
          <table class="table table-bordered table-striped" id="categoryTable2">
            <thead>
              <tr>
                <th>#</th>
                <th>Category Name</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      </div>
      <!-- END LIST CATEGORY SECTION -->

      <!-- ADD ORDER SECTION -->
      <div class="app-content" id="addOrder" style="display:none;">
        <div class="container-fluid">
          <h2>Add Order</h2>
          <input type="hidden" id="editOrderIndex" value="-1" />
          <form onsubmit="handleOrderForm(event)">
            <input type="text" id="orderName" class="form-control mb-2" placeholder="Order Name" required>
            <input type="number" id="orderqty" class="form-control mb-2" placeholder="Quantity" required>
            <input type="date" id="orderDate" class="form-control mb-2" required>
            <select id="orderProduct" class="form-control mb-2" required>
              <option value="">Select Product</option>
            </select>
            <button type="submit" class="btn btn-primary" id="orderBtn">Save Order</button>
          </form>

          <h3 class="mt-4">List Orders</h3>
          <table class="table table-bordered table-striped" id="orderTable">
            <thead>
              <tr>
                <th>#</th>
                <th>Order Name</th>
                <th>QTY</th>
                <th>Date</th>
                <th>Product</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      </div>
      <!-- END ADD ORDER SECTION -->

      <!-- LIST ORDER SECTION -->
      <div class="app-content" id="listOrders" style="display:none;">
        <div class="container-fluid">
          <h2>Order List</h2>
          <table class="table table-bordered table-striped" id="orderTable2">
            <thead>
              <tr>
                <th>#</th>
                <th>Order Name</th>
                <th>QTY</th>
                <th>Date</th>
                <th>Product</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      </div>
      <!-- END LIST ORDER SECTION -->

      <!-- ADD USER SECTION -->
      <div class="app-content" id="addUser" style="display:none;">
        <div class="container-fluid">
          <h2>Add User</h2>
          <input type="hidden" id="editUserIndex" value="-1" />
          <form onsubmit="handleUserForm(event)">
            <input type="text" id="userName" class="form-control mb-2" placeholder="User Name" required>
            <input type="email" id="userEmail" class="form-control mb-2" placeholder="Email" required>
            <input type="text" id="userPhone" class="form-control mb-2" placeholder="Phone">
            <button type="submit" class="btn btn-primary" id="userBtn">Save User</button>
          </form>

          <h3 class="mt-4">List Users</h3>
          <table class="table table-bordered table-striped" id="userTable">
            <thead>
              <tr>
                <th>#</th>
                <th>User Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      </div>
      <!-- END ADD USER SECTION -->

      <!-- LIST USER SECTION -->
      <div class="app-content" id="listUsers" style="display:none;">
        <div class="container-fluid">
          <h2>User List</h2>
          <table class="table table-bordered table-striped" id="userTable2">
            <thead>
              <tr>
                <th>#</th>
                <th>User Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      </div>
      <!-- END LIST USER SECTION -->

      <!-- SITTING SECTION -->
      <div class="app-content" id="sitting" style="display:none;">
        <div class="container-fluid">
          <h2>Sitting</h2>
          <p>Some setting here...</p>
        </div>
      </div>
      <!-- END SITTING SECTION -->
    </main>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.10.1/browser/overlayscrollbars.browser.es6.min.js" integrity="sha256-dghWARbRe2eLlIJ56wNB+b760ywulqK3DzZYEpsg2fQ=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
  <script src="admin.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
  OverlayScrollbars(document.querySelectorAll("body"), { });
});

    // Update Dashboard Counts
    function updateDashboardCounts() {
      let products = JSON.parse(localStorage.getItem("products")) || [];
      let orders = JSON.parse(localStorage.getItem("orders")) || [];
      let categories = JSON.parse(localStorage.getItem("categories")) || [];
      let users = JSON.parse(localStorage.getItem("users")) || [];
      document.getElementById("productCount").innerText = products.length;
      document.getElementById("orderCount").innerText = orders.length;
      document.getElementById("categoryCount").innerText = categories.length;
      document.getElementById("userCount").innerText = users.length;
    }

    document.addEventListener("DOMContentLoaded", function() {
      updateDashboardCounts();
    });

    // Show/Hide Sections
    function showSection(section) {
      document.getElementById("dashboard").style.display = "none";
      document.getElementById("addProduct").style.display = "none";
      document.getElementById("listProduct").style.display = "none";
      document.getElementById("addCategory").style.display = "none";
      document.getElementById("listCategory").style.display = "none";
      document.getElementById("addOrder").style.display = "none";
      document.getElementById("listOrders").style.display = "none";
      document.getElementById("addUser").style.display = "none";
      document.getElementById("listUsers").style.display = "none";
      document.getElementById("sitting").style.display = "none";

      document.getElementById(section).style.display = "block";

      if (section === "addProduct") loadProducts();
      if (section === "listProduct") loadProducts2();
      if (section === "addCategory") loadCategories();
      if (section === "listCategory") loadCategories2();
      if (section === "addOrder") {
        loadOrders();
        loadProductDropdown(); // Refresh product dropdown for orders
      }
      if (section === "listOrders") loadOrders2();
      if (section === "addUser") loadUsers();
      if (section === "listUsers") loadUsers2();
    }

    // PRODUCT LOGIC
    function handleProductForm(event) {
      event.preventDefault();
      let idx = parseInt(document.getElementById("editProductIndex").value, 10);
      if (idx >= 0) {
        updateProduct(idx);
      } else {
        saveProduct();
      }
    }

    function saveProduct() {
      let products = JSON.parse(localStorage.getItem("products")) || [];
      let product = {
        name: document.getElementById("productName").value,
        price: document.getElementById("productPrice").value,
        qty: parseInt(document.getElementById("productQty").value, 10),
        cat: document.getElementById("category").value,
        desc: document.getElementById("productDesc").value
      };
      products.push(product);
      localStorage.setItem("products", JSON.stringify(products));
      alert("Product Saved");
      resetProductForm();
      loadProducts();
      updateDashboardCounts();
    }

    function loadProducts() {
      let products = JSON.parse(localStorage.getItem("products")) || [];
      let tbody = document.querySelector("#productTable tbody");
      tbody.innerHTML = "";
      products.forEach((p, i) => {
        let row = document.createElement("tr");
        row.innerHTML = `
          <td>${i + 1}</td>
          <td>${p.name}</td>
          <td>${p.price}</td>
          <td>${p.qty}</td>
          <td>${p.cat}</td>
          <td>${p.desc}</td>
          <td>
            <button class="btn btn-sm btn-warning" onclick="editProduct(${i})">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteProduct(${i})">Delete</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function loadProducts2() {
      let products = JSON.parse(localStorage.getItem("products")) || [];
      let tbody = document.querySelector("#productTable2 tbody");
      tbody.innerHTML = "";
      products.forEach((p, i) => {
        let row = document.createElement("tr");
        row.innerHTML = `
          <td>${i + 1}</td>
          <td>${p.name}</td>
          <td>${p.price}</td>
          <td>${p.qty}</td>
          <td>${p.cat}</td>
          <td>${p.desc}</td>
          <td>
            <button class="btn btn-sm btn-warning" onclick="editProductInAdd(${i})">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteProduct(${i})">Delete</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function editProduct(index) {
      let products = JSON.parse(localStorage.getItem("products")) || [];
      let p = products[index];
      document.getElementById("productName").value = p.name;
      document.getElementById("productPrice").value = p.price;
      document.getElementById("productQty").value = p.qty;
      document.getElementById("category").value = p.cat;
      document.getElementById("productDesc").value = p.desc;
      document.getElementById("editProductIndex").value = index;
      document.getElementById("productBtn").textContent = "Update Product";
    }

    function editProductInAdd(index) {
      showSection("addProduct");
      editProduct(index);
    }

    function updateProduct(index) {
      let products = JSON.parse(localStorage.getItem("products")) || [];
      products[index].name = document.getElementById("productName").value;
      products[index].price = document.getElementById("productPrice").value;
      products[index].qty = parseInt(document.getElementById("productQty").value, 10);
      products[index].cat = document.getElementById("category").value;
      products[index].desc = document.getElementById("productDesc").value;
      localStorage.setItem("products", JSON.stringify(products));
      alert("Product Updated");
      resetProductForm();
      loadProducts();
    }

    function deleteProduct(index) {
      if (!confirm("Are you sure you want to delete this product?")) return;
      let products = JSON.parse(localStorage.getItem("products")) || [];
      products.splice(index, 1);
      localStorage.setItem("products", JSON.stringify(products));
      loadProducts();
      loadProducts2();
    }

    function resetProductForm() {
      document.getElementById("editProductIndex").value = -1;
      document.getElementById("productName").value = "";
      document.getElementById("productPrice").value = "";
      document.getElementById("productQty").value = "";
      document.getElementById("category").value = "";
      document.getElementById("productDesc").value = "";
      document.getElementById("productBtn").textContent = "Save Product";
    }

    // Category Dropdown
    function loadCategoriesDropdown() {
      let dropdown = document.getElementById("category");
      if (!dropdown) return;
      let categories = JSON.parse(localStorage.getItem("categories")) || [];
      dropdown.innerHTML = '<option value="">Select Category</option>';
      categories.forEach(cat => {
        let option = document.createElement("option");
        option.value = cat;
        option.textContent = cat;
        dropdown.appendChild(option);
      });
    }
    document.addEventListener("DOMContentLoaded", () => {
      setTimeout(loadCategoriesDropdown, 0);
    });

    // Order Product Dropdown
    function loadProductDropdown() {
      let dropdown = document.getElementById("orderProduct");
      if (!dropdown) return;
      let products = JSON.parse(localStorage.getItem("products")) || [];
      dropdown.innerHTML = '<option value="">Select Product</option>';
      products.forEach(product => {
        let option = document.createElement("option");
        option.value = product.name;
        option.textContent = product.name;
        dropdown.appendChild(option);
      });
    }
    document.addEventListener("DOMContentLoaded", () => {
      setTimeout(loadProductDropdown, 0);
    });

    // CATEGORY LOGIC
    function handleCategoryForm(event) {
      event.preventDefault();
      let idx = parseInt(document.getElementById("editCategoryIndex").value, 10);
      if (idx >= 0) {
        updateCategory(idx);
      } else {
        saveCategory();
      }
    }

    function saveCategory() {
      let categories = JSON.parse(localStorage.getItem("categories")) || [];
      let catName = document.getElementById("categoryName").value.trim();
      if (catName && !categories.includes(catName)) {
        categories.push(catName);
        localStorage.setItem("categories", JSON.stringify(categories));
        alert("Category Saved");
      } else {
        alert("Category already exists or invalid!");
      }
      resetCategoryForm();
      loadCategories();
    }

    function loadCategories() {
      let categories = JSON.parse(localStorage.getItem("categories")) || [];
      let tbody = document.querySelector("#categoryTable tbody");
      tbody.innerHTML = "";
      categories.forEach((c, i) => {
        let row = document.createElement("tr");
        row.innerHTML = `
          <td>${i + 1}</td>
          <td>${c}</td>
          <td>
            <button class="btn btn-sm btn-warning" onclick="editCategory(${i})">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteCategory(${i})">Delete</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function loadCategories2() {
      let categories = JSON.parse(localStorage.getItem("categories")) || [];
      let tbody = document.querySelector("#categoryTable2 tbody");
      tbody.innerHTML = "";
      categories.forEach((c, i) => {
        let row = document.createElement("tr");
        row.innerHTML = `
          <td>${i + 1}</td>
          <td>${c}</td>
          <td>
            <button class="btn btn-sm btn-warning" onclick="editCategoryInAdd(${i})">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteCategory(${i})">Delete</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function editCategory(index) {
      let categories = JSON.parse(localStorage.getItem("categories")) || [];
      document.getElementById("categoryName").value = categories[index];
      document.getElementById("editCategoryIndex").value = index;
      document.getElementById("categoryBtn").textContent = "Update Category";
    }

    function editCategoryInAdd(index) {
      showSection("addCategory");
      editCategory(index);
    }

    function updateCategory(index) {
      let categories = JSON.parse(localStorage.getItem("categories")) || [];
      let newCat = document.getElementById("categoryName").value.trim();
      if (newCat && (!categories.includes(newCat) || categories[index] === newCat)) {
        categories[index] = newCat;
        localStorage.setItem("categories", JSON.stringify(categories));
        alert("Category Updated");
      } else {
        alert("Category already exists or invalid!");
      }
      resetCategoryForm();
      loadCategories();
    }

    function deleteCategory(index) {
      if (!confirm("Are you sure you want to delete this category?")) return;
      let categories = JSON.parse(localStorage.getItem("categories")) || [];
      categories.splice(index, 1);
      localStorage.setItem("categories", JSON.stringify(categories));
      loadCategories();
      loadCategories2();
    }

    function resetCategoryForm() {
      document.getElementById("editCategoryIndex").value = -1;
      document.getElementById("categoryName").value = "";
      document.getElementById("categoryBtn").textContent = "Save Category";
    }

    // ORDER LOGIC
    function handleOrderForm(event) {
      event.preventDefault();
      let idx = parseInt(document.getElementById("editOrderIndex").value, 10);
      if (idx >= 0) {
        updateOrder(idx);
      } else {
        saveOrder();
      }
    }

    function saveOrder() {
      let orders = JSON.parse(localStorage.getItem("orders")) || [];
      let products = JSON.parse(localStorage.getItem("products")) || [];
      let orderProductName = document.getElementById("orderProduct").value;
      let orderQty = parseInt(document.getElementById("orderqty").value, 10);

      // Find product by name
      let productIndex = products.findIndex(p => p.name === orderProductName);
      if (productIndex === -1) {
        alert("Product not found!");
        return;
      }
      if (products[productIndex].qty < orderQty) {
        alert("Insufficient stock!");
        return;
      }

      // Deduct order quantity from product stock
      products[productIndex].qty -= orderQty;

      let order = {
        name: document.getElementById("orderName").value,
        qty: orderQty,
        date: document.getElementById("orderDate").value,
        product: orderProductName
      };

      orders.push(order);
      localStorage.setItem("orders", JSON.stringify(orders));
      localStorage.setItem("products", JSON.stringify(products));
      alert("Order Saved");
      resetOrderForm();
      loadOrders();
      updateDashboardCounts();
    }

    function loadOrders() {
      let orders = JSON.parse(localStorage.getItem("orders")) || [];
      let tbody = document.querySelector("#orderTable tbody");
      tbody.innerHTML = "";
      orders.forEach((o, i) => {
        let row = document.createElement("tr");
        row.innerHTML = `
          <td>${i + 1}</td>
          <td>${o.name}</td>
          <td>${o.qty}</td>
          <td>${o.date}</td>
          <td>${o.product}</td>
          <td>
            <button class="btn btn-sm btn-warning" onclick="editOrder(${i})">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteOrder(${i})">Delete</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function loadOrders2() {
      let orders = JSON.parse(localStorage.getItem("orders")) || [];
      let tbody = document.querySelector("#orderTable2 tbody");
      tbody.innerHTML = "";
      orders.forEach((o, i) => {
        let row = document.createElement("tr");
        row.innerHTML = `
          <td>${i + 1}</td>
          <td>${o.name}</td>
          <td>${o.qty}</td>
          <td>${o.date}</td>
          <td>${o.product}</td>
          <td>
            <button class="btn btn-sm btn-warning" onclick="editOrderInAdd(${i})">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteOrder(${i})">Delete</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function editOrder(index) {
      let orders = JSON.parse(localStorage.getItem("orders")) || [];
      let o = orders[index];
      document.getElementById("orderName").value = o.name;
      document.getElementById("orderqty").value = o.qty;
      document.getElementById("orderDate").value = o.date;
      document.getElementById("orderProduct").value = o.product;
      document.getElementById("editOrderIndex").value = index;
      document.getElementById("orderBtn").textContent = "Update Order";
    }

    function editOrderInAdd(index) {
      showSection("addOrder");
      editOrder(index);
    }

    function updateOrder(index) {
      let orders = JSON.parse(localStorage.getItem("orders")) || [];
      orders[index].name = document.getElementById("orderName").value;
      orders[index].qty = parseInt(document.getElementById("orderqty").value, 10);
      orders[index].date = document.getElementById("orderDate").value;
      orders[index].product = document.getElementById("orderProduct").value;
      localStorage.setItem("orders", JSON.stringify(orders));
      alert("Order Updated");
      resetOrderForm();
      loadOrders();
    }

    function deleteOrder(index) {
      if (!confirm("Are you sure you want to delete this order?")) return;
      let orders = JSON.parse(localStorage.getItem("orders")) || [];
      orders.splice(index, 1);
      localStorage.setItem("orders", JSON.stringify(orders));
      loadOrders();
      loadOrders2();
    }

    function resetOrderForm() {
      document.getElementById("editOrderIndex").value = -1;
      document.getElementById("orderName").value = "";
      document.getElementById("orderqty").value = "";
      document.getElementById("orderDate").value = "";
      document.getElementById("orderProduct").value = "";
      document.getElementById("orderBtn").textContent = "Save Order";
    }

    // USER LOGIC
    function handleUserForm(event) {
      event.preventDefault();
      let idx = parseInt(document.getElementById("editUserIndex").value, 10);
      if (idx >= 0) {
        updateUser(idx);
      } else {
        saveUser();
      }
    }

    function saveUser() {
      let users = JSON.parse(localStorage.getItem("users")) || [];
      let user = {
        name: document.getElementById("userName").value,
        email: document.getElementById("userEmail").value,
        phone: document.getElementById("userPhone").value
      };
      users.push(user);
      localStorage.setItem("users", JSON.stringify(users));
      alert("User Saved");
      resetUserForm();
      loadUsers();
    }

    function loadUsers() {
      let users = JSON.parse(localStorage.getItem("users")) || [];
      let tbody = document.querySelector("#userTable tbody");
      tbody.innerHTML = "";
      users.forEach((u, i) => {
        let row = document.createElement("tr");
        row.innerHTML = `
          <td>${i + 1}</td>
          <td>${u.name}</td>
          <td>${u.email}</td>
          <td>${u.phone || ""}</td>
          <td>
            <button class="btn btn-sm btn-warning" onclick="editUser(${i})">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteUser(${i})">Delete</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function loadUsers2() {
      let users = JSON.parse(localStorage.getItem("users")) || [];
      let tbody = document.querySelector("#userTable2 tbody");
      tbody.innerHTML = "";
      users.forEach((u, i) => {
        let row = document.createElement("tr");
        row.innerHTML = `
          <td>${i + 1}</td>
          <td>${u.name}</td>
          <td>${u.email}</td>
          <td>${u.phone || ""}</td>
          <td>
            <button class="btn btn-sm btn-warning" onclick="editUserInAdd(${i})">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteUser(${i})">Delete</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function editUser(index) {
      let users = JSON.parse(localStorage.getItem("users")) || [];
      let u = users[index];
      document.getElementById("userName").value = u.name;
      document.getElementById("userEmail").value = u.email;
      document.getElementById("userPhone").value = u.phone;
      document.getElementById("editUserIndex").value = index;
      document.getElementById("userBtn").textContent = "Update User";
    }

    function editUserInAdd(index) {
      showSection("addUser");
      editUser(index);
    }

    function updateUser(index) {
      let users = JSON.parse(localStorage.getItem("users")) || [];
      users[index].name = document.getElementById("userName").value;
      users[index].email = document.getElementById("userEmail").value;
      users[index].phone = document.getElementById("userPhone").value;
      localStorage.setItem("users", JSON.stringify(users));
      alert("User Updated");
      resetUserForm();
      loadUsers();
    }

    function deleteUser(index) {
      if (!confirm("Are you sure you want to delete this user?")) return;
      let users = JSON.parse(localStorage.getItem("users")) || [];
      users.splice(index, 1);
      localStorage.setItem("users", JSON.stringify(users));
      loadUsers();
      loadUsers2();
    }

    function resetUserForm() {
      document.getElementById("editUserIndex").value = -1;
      document.getElementById("userName").value = "";
      document.getElementById("userEmail").value = "";
      document.getElementById("userPhone").value = "";
      document.getElementById("userBtn").textContent = "Save User";
    }
  </script>
</body>
</html>
